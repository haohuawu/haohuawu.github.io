

<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0">
  <title>移动端H5视频播放的那些事儿</title>
  <meta name="description" content="移动端使用H5video标签能在网页中直接播放视频而无需安装flash插件，结合js与css能创造出比帧动画表现力更丰富的交互（想想炫酷的WebGL加上video），同时，GIF 相比视频，以 H.264 编码的 MP4 为例，带宽占用为十二倍，电池消耗为两倍。没有声音的video元素很适合用作网页背景，取代 GIF。2010年，乔布斯预言了HTML5的未来，相比flash，H5在移动端有着友好的">
<meta property="og:type" content="article">
<meta property="og:title" content="移动端H5视频播放的那些事儿">
<meta property="og:url" content="https://haohuawu.github.io/2017/03/05/h5-video-player/index.html">
<meta property="og:site_name" content="天枢">
<meta property="og:description" content="移动端使用H5video标签能在网页中直接播放视频而无需安装flash插件，结合js与css能创造出比帧动画表现力更丰富的交互（想想炫酷的WebGL加上video），同时，GIF 相比视频，以 H.264 编码的 MP4 为例，带宽占用为十二倍，电池消耗为两倍。没有声音的video元素很适合用作网页背景，取代 GIF。2010年，乔布斯预言了HTML5的未来，相比flash，H5在移动端有着友好的">
<meta property="og:image" content="https://haohuawu.github.io/assets/images/html5-video-browser-support.png">
<meta property="og:image" content="https://haohuawu.github.io/assets/images/html5-video-format-browser-support.png">
<meta property="og:image" content="https://haohuawu.github.io/assets/images/tbs-video-fullscreen-api.png">
<meta property="og:updated_time" content="2017-03-25T08:56:39.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="移动端H5视频播放的那些事儿">
<meta name="twitter:description" content="移动端使用H5video标签能在网页中直接播放视频而无需安装flash插件，结合js与css能创造出比帧动画表现力更丰富的交互（想想炫酷的WebGL加上video），同时，GIF 相比视频，以 H.264 编码的 MP4 为例，带宽占用为十二倍，电池消耗为两倍。没有声音的video元素很适合用作网页背景，取代 GIF。2010年，乔布斯预言了HTML5的未来，相比flash，H5在移动端有着友好的">
<meta name="twitter:image" content="https://haohuawu.github.io/assets/images/html5-video-browser-support.png">
  <link rel="stylesheet" href="/blog/styles/main.css">
</head>
  <body>
    <header class="site--header" role="banner">
  <div class="wrapper">
    <a class="site--title" href="/">天枢</a>
    
    <a class="nav-menu" href="javascript: void 0;"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 32 32">
<path fill="#424242" d="M2 6.667h28v3.135h-28v-3.135zM2 17.531v-3.063h28v3.063h-28zM2 25.333v-3.135h28v3.135h-28z"></path>
</svg>
</a>
    
  </div>
</header>

    <main class="site--content" aria-label="Content">
      <div class="wrapper">
        <article
  id="post-h5-video-player"
  class="post"
  data-layout="post"
  data-site-index="post"
  itemscope
  itemprop="blogPost">
  <!-- title -->
  
  
  
<h1 class="post-title" itemprop="name">
  移动端H5视频播放的那些事儿
</h1>
  

  
  <!-- meta -->
  <div class="post-meta">
  
  <span class="post-date post-meta--item">
  <span class="icon icon---date"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 28 28">
<path fill="#828282" d="M14.714 7.049v7.275l6.236 3.703-1.039 1.754-7.275-4.417v-8.315h2.079zM14 25.108c6.106 0 11.108-5.002 11.108-11.108s-5.002-11.108-11.108-11.108-11.108 5.002-11.108 11.108 5.002 11.108 11.108 11.108zM14 0.164c7.665 0 13.836 6.171 13.836 13.836s-6.171 13.836-13.836 13.836-13.836-6.171-13.836-13.836 6.171-13.836 13.836-13.836z"></path>
</svg>
</span>
  <time datetime="2017-03-04T16:00:00.000Z" itemprop="datePublished">2017-03-05</time>
</span>
  
  
<div class="post-tags post-meta--item">
  <span class="icon icon---tag"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 28 28">
<path fill="#828282" d="M26.688 0h-10.5c-0.722 0-1.73 0.418-2.241 0.928l-13.019 13.019c-0.51 0.51-0.51 1.346 0 1.856l11.269 11.269c0.51 0.51 1.346 0.51 1.856 0l13.019-13.019c0.51-0.51 0.928-1.519 0.928-2.241v-10.5c0-0.722-0.591-1.313-1.313-1.313zM20.125 10.5c-1.45 0-2.625-1.175-2.625-2.625s1.175-2.625 2.625-2.625 2.625 1.175 2.625 2.625-1.175 2.625-2.625 2.625z"></path>
</svg>
</span>
  <ul class="tag-list"><li class="tag-list--item"><a class="tag-list--link" href="/tags/html5/">#HTML5</a></li><li class="tag-list--item"><a class="tag-list--link" href="/tags/video/">#Video</a></li><li class="tag-list--item"><a class="tag-list--link" href="/tags/http-live-streaming/">#HTTP Live Streaming</a></li></ul>
</div>

  

</div>
  <!-- gallery -->
  
  <!-- entry -->
  <main class="post--entry" itemprop="articleBody">
    <p>移动端使用H5<code>video</code>标签能在网页中直接播放视频而无需安装flash插件，结合js与css能创造出比帧动画表现力更丰富的交互（想想炫酷的WebGL加上video），同时，GIF 相比视频，以 H.264 编码的 MP4 为例，带宽占用为十二倍，电池消耗为两倍。没有声音的<code>video</code>元素很适合用作网页背景，取代 GIF。2010年，乔布斯预言了HTML5的未来，相比flash，H5在移动端有着友好的支持：</p>
<p><img src="/assets/images/html5-video-browser-support.png" alt="HTML5 Video 浏览器兼容表，数据来自于http://caniuse.com/#feat=video"></p>
<a id="more"></a>
<p>尽管如此，在实际开发中还是有不少的坑，在此做个记录。</p>
<h3 id="各平台支持不同的视频格式"><a href="#各平台支持不同的视频格式" class="headerlink" title="各平台支持不同的视频格式"></a>各平台支持不同的视频格式</h3><p>详见<a href="http://www.ruanyifeng.com/blog/2010/05/html5_codec_fight.html" target="_blank" rel="external">HTML5的视频格式之争 - 阮一峰的网络日志</a>，即并不是所有的浏览器都支持同一种格式：</p>
<p><img src="/assets/images/html5-video-format-browser-support.png" alt="HTML5 Video 视频格式浏览器支持"></p>
<p>制作多种格式的视频</p>
<ul>
<li>桌面工具：<ul>
<li><a href="https://ffmpeg.org/" target="_blank" rel="external">FFmpeg - 大师级</a></li>
</ul>
</li>
<li>GUI应用:<ul>
<li><a href="https://www.mirovideoconverter.com/" target="_blank" rel="external">Miro</a></li>
<li><a href="https://handbrake.fr/" target="_blank" rel="external">HandBrake - 入门级</a></li>
<li><a href="https://www.videolan.org/" target="_blank" rel="external">VLC - 玩家级</a></li>
</ul>
</li>
<li>在线编码/转码服务：<ul>
<li><a href="https://en.wikipedia.org/wiki/Zencoder" target="_blank" rel="external">Zencoder</a></li>
<li><a href="https://aws.amazon.com/elastictranscoder" target="_blank" rel="external">Amazon Elastic Encoder</a></li>
</ul>
</li>
</ul>
<h3 id="移动端视频无法自动播放-预加载-webview除外"><a href="#移动端视频无法自动播放-预加载-webview除外" class="headerlink" title="移动端视频无法自动播放/预加载(webview除外)"></a>移动端视频无法自动播放/预加载(webview除外)</h3><figure class="highlight obj-c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// iOS, UIWebView设置允许视频自动播放</span></div><div class="line">uiWebView.allowsInlineMediaPlayback = <span class="literal">YES</span>;</div><div class="line">uiWebView.mediaPlaybackRequiresUserAction = <span class="literal">NO</span>;</div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Android</span></div><div class="line"><span class="keyword">int</span> SDK_INT = android.os.Build.VERSION.SDK_INT;</div><div class="line"><span class="keyword">if</span> (SDK_INT &gt; <span class="number">16</span>) &#123;</div><div class="line">  engine.getSettings().setMediaPlaybackRequiresUserGesture(<span class="keyword">false</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="UC、小米等安卓浏览器劫持video标签，用其“自己”的播放器来播放视频，“破坏”了产品本身的播放体验"><a href="#UC、小米等安卓浏览器劫持video标签，用其“自己”的播放器来播放视频，“破坏”了产品本身的播放体验" class="headerlink" title="UC、小米等安卓浏览器劫持video标签，用其“自己”的播放器来播放视频，“破坏”了产品本身的播放体验"></a>UC、小米等安卓浏览器劫持video标签，用其“自己”的播放器来播放视频，“破坏”了产品本身的播放体验</h3><p>无解</p>
<h3 id="安卓版微信、QQ、iOS-播放视频自动全屏-全屏浮层"><a href="#安卓版微信、QQ、iOS-播放视频自动全屏-全屏浮层" class="headerlink" title="安卓版微信、QQ、iOS 播放视频自动全屏/全屏浮层"></a>安卓版微信、QQ、iOS 播放视频自动全屏/全屏浮层</h3><p>安卓版微信、QQ使用的是腾讯的X5 TBS内核，目前无解，如果你看过一些腾讯的视频类 HTML5，会发现它们在微信里是可以内联播放的，而这个功能是需要申请加入白名单的（目前已关闭该通道），不过新版的 TBS 内核（&gt;=036849）支持一个叫 同层播放器 的视频播放器，这个不需要申请白名单，只需给 video 设置两个属性 x5-video-player-type=”h5” 和 x5-video-player-fullscreen=”true”。退出播放时，我们需要做相应的处理。TBS 有提供相应的事件，不过不同的版本有一点差异：</p>
<p><img src="/assets/images/tbs-video-fullscreen-api.png" alt="TBS Video Fullscreen API"></p>
<p>好消息是 iOS 10+ 新增了<code>playsinline</code>属性（ iOS 4+的 webview 可以使用<code>webkit-playsinline</code> 详见<a href="https://webkit.org/blog/6784/new-video-policies-for-ios/" target="_blank" rel="external">iOS 10 Safari 视频播放新政策</a>）使视频内联播放。至于iOS 8 和 9可以试一下这个库<a href="https://github.com/bfred-it/iphone-inline-video" target="_blank" rel="external">iphone-inline-video</a></p>
<p>另附：<a href="http://bbs.mb.qq.com/thread-1128196-1-1.html" target="_blank" rel="external">微信6.3.15打开网页video标签webkit-playsinline失效</a></p>
<p>未完待续。。。</p>
<p>参考：</p>
<ul>
<li><a href="http://www.apple.com/hotnews/thoughts-on-flash/" target="_blank" rel="external">Steve Job’s bet on HTML5</a></li>
<li><a href="http://www.ruanyifeng.com/blog/2010/05/html5_codec_fight.html" target="_blank" rel="external">HTML5的视频格式之争 - 阮一峰的网络日志</a></li>
<li><a href="https://en.wikipedia.org/wiki/HTML5_video" target="_blank" rel="external">HTML5 Video - wiki</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Supported_media_formats" target="_blank" rel="external">Supported_media_formats - MDN</a></li>
<li><a href="https://webkit.org/blog/6784/new-video-policies-for-ios/" target="_blank" rel="external">iOS 10 Safari 视频播放新政策</a></li>
<li><a href="https://www.w3.org/2010/05/video/mediaevents.html" target="_blank" rel="external">HTML5 Video Events and API检测工具</a></li>
<li><a href="http://videojs.com/" target="_blank" rel="external">video.js</a></li>
<li><a href="https://github.com/dailymotion/hls.js" target="_blank" rel="external">hls.js</a></li>
<li><a href="http://stackoverflow.com/questions/2983555/is-there-a-way-to-use-drm-on-html5-video" target="_blank" rel="external">视频内容保护 HTML5 DRM(Digital Rights Management)</a></li>
</ul>

  </main>
  <!-- navigation -->
  
<nav class="post-nav">
  
  <a href="/2017/03/13/writing-maintainable-css/" class="post-nav--link">
    <strong class="post-nav--caption">上一篇</strong>
    
    <div class="post-nav--title">
      编写可维护的CSS
    </div>
    
  </a>
  
  
</nav>

  <!-- footer -->
  
</article>
<aside class="side-bar">
  <div class="side-bar--wrapper">
    
<nav class="post-nav">
  
  <a href="/2017/03/13/writing-maintainable-css/" class="post-nav--link">
    <strong class="post-nav--caption">上一篇</strong>
    
  </a>
  
  
</nav>

    <!-- toc -->
    <ul class="toc"><li class="toc--item"><a title="各平台支持不同的视频格式" class="toc--item--anchor" href="#各平台支持不同的视频格式" data-depth="0"><span class="toc--number">1</span>各平台支持不同的视频格式</a></li><li class="toc--item"><a title="移动端视频无法自动播放/预加载(webview除外)" class="toc--item--anchor" href="#移动端视频无法自动播放-预加载-webview除外" data-depth="0"><span class="toc--number">2</span>移动端视频无法自动播放/预加载(webview除外)</a></li><li class="toc--item"><a title="UC、小米等安卓浏览器劫持video标签，用其“自己”的播放器来播放视频，“破坏”了产品本身的播放体验" class="toc--item--anchor" href="#UC、小米等安卓浏览器劫持video标签，用其“自己”的播放器来播放视频，“破坏”了产品本身的播放体验" data-depth="0"><span class="toc--number">3</span>UC、小米等安卓浏览器劫持video标签，用其“自己”的播放器来播放视频，“破坏”了产品本身的播放体验</a></li><li class="toc--item"><a title="安卓版微信、QQ、iOS 播放视频自动全屏/全屏浮层" class="toc--item--anchor" href="#安卓版微信、QQ、iOS-播放视频自动全屏-全屏浮层" data-depth="0"><span class="toc--number">4</span>安卓版微信、QQ、iOS 播放视频自动全屏/全屏浮层</a></li></ul>
  </div>
</aside>
      </div>
    </main>
    <footer class="site--footer">
  <div class="wrapper">
    <h2 class="footer--heading">天枢</h2>
    <div class="footer-col-wrapper">
    
      <div class="footer-col footer-col---3">
        <ul class="slash-list">
          <li>他强由他强，清风拂山岗</li>
          <li>
            <a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/3.0/">
              <img alt="知识共享许可协议" style="border-width: 0" src="https://i.creativecommons.org/l/by-nc-nd/3.0/80x15.png" />
            </a>
          </li>
        </ul>
      </div>
    </div>
  </div>
</footer>
    <script src="/blog/js/manifest.js"></script>
<script src="/blog/js/vendor.js"></script>
<script src="/blog/js/main.js"></script>
  </body>
</html>
